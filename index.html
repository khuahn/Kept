<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kept</title>
  <link rel="icon" href="/icons/icon-192x192.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    :root {
      --background-color: #121212;
      --note-bg: #1a1a1a;
      --text-color: #e0e0e0;
      --border-color: #333;
      --input-bg: #2a2a2a;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --teal-accent: #008080;
      --border-radius: 6px;
    }
    body.light-mode {
      --background-color: #f0f0f0;
      --note-bg: #ffffff;
      --text-color: #333333;
      --border-color: #ddd;
      --input-bg: #f5f5f5;
      --shadow-color: rgba(0, 0, 0, 0.1);
    }
    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--background-color);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
      color: var(--teal-accent);
    }
    header h1 span {
      font-size: 14px;
      color: var(--text-color);
      margin-left: 10px;
    }
    .header-buttons {
      display: flex;
      align-items: center;
    }
    #create-note-btn, #theme-toggle, #download-all-btn, #upload-btn {
      position: static;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px var(--shadow-color);
      width: 40px;
      height: 40px;
      font-size: 20px;
    }
    #create-note-btn {
      background-color: var(--teal-accent);
      color: white;
      border: none;
      margin-right: 15px;
    }
    #download-all-btn, #upload-btn {
      background-color: var(--note-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      margin-right: 15px;
    }
    #theme-toggle {
      background-color: var(--note-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    .memo-container {
      padding: 10px;
      flex-grow: 1;
    }
    .notes-grid {
      column-gap: 10px;
      column-count: 10;
    }
    @media (max-width: 1800px) { .notes-grid { column-count: 8; } }
    @media (max-width: 1400px) { .notes-grid { column-count: 6; } }
    @media (max-width: 1200px) { .notes-grid { column-count: 5; } }
    @media (max-width: 992px) { .notes-grid { column-count: 4; } }
    @media (max-width: 768px) { .notes-grid { column-count: 3; } }
    @media (max-width: 576px) { .notes-grid { column-count: 2; } }
    @media (max-width: 400px) { .notes-grid { column-count: 1; } }
    .note-card {
      background-color: var(--note-bg);
      border-radius: var(--border-radius);
      padding: 15px;
      cursor: pointer;
      box-shadow: 0 2px 8px var(--shadow-color);
      break-inside: avoid;
      page-break-inside: avoid;
      margin-bottom: 10px;
    }
    .note-card h3 {
      margin: 0;
      font-size: 1em;
      color: var(--teal-accent);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
    }
    .modal-content {
      background-color: var(--note-bg);
      margin: 10% auto;
      padding: 20px;
      border-radius: var(--border-radius);
      width: 80%;
      max-width: 800px;
      box-shadow: 0 4px 12px var(--shadow-color);
    }
    .modal-content input, .modal-content textarea {
      width: calc(100% - 40px);
      padding: 10px;
      margin-bottom: 10px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      background-color: var(--input-bg);
      color: var(--text-color);
    }
    .note-timestamp {
      font-size: 0.8em;
      font-style: italic;
      color: #777;
      text-align: right;
      margin-top: 20px;
    }
    .modal-buttons {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
    }
    .modal-buttons button {
      border: none;
      cursor: pointer;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 18px;
      margin-left: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--note-bg);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    .modal-buttons button:hover { background-color: var(--input-bg); }
    .modal-buttons .save-btn { background-color: var(--teal-accent); color: white; border: none;}
    .modal-buttons .delete-btn { color: #c0392b; }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 12px;
      color: #777;
    }
    footer a {
      color: var(--teal-accent);
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <header>
    <h1>Kept™ <span>How notes should be Kept!</span></h1>
    <div class="header-buttons">
      <button id="create-note-btn" title="New Kept"><i class="fas fa-plus"></i></button>
      <button id="upload-btn" title="Upload Notes"><i class="fas fa-upload"></i></button>
      <button id="download-all-btn" title="Download All"><i class="fas fa-archive"></i></button>
      <button id="theme-toggle" title="Toggle Theme"><i class="fas fa-moon"></i></button>
    </div>
  </header>

  <div class="memo-container">
    <div id="notes-grid" class="notes-grid"></div>
  </div>

  <input type="file" id="upload-input" accept=".txt" multiple style="display: none;">

  <div id="note-modal" class="modal">
    <div class="modal-content">
      <input type="text" id="note-title-input" placeholder="Title">
      <textarea id="note-content-input" placeholder="Take a note..." rows="10"></textarea>
      <div class="modal-buttons">
        <button id="save-note-btn" class="save-btn" title="Save"><i class="fas fa-check"></i></button>
        <button id="cancel-note-btn" title="Cancel"><i class="fas fa-times"></i></button>
      </div>
    </div>
  </div>

  <div id="view-note-modal" class="modal">
    <div class="modal-content">
      <h2 id="view-note-title"></h2>
      <p id="view-note-content"></p>
      <p id="view-note-timestamp" class="note-timestamp"></p>
      <div class="modal-buttons">
        <button id="edit-note-btn" title="Edit"><i class="fas fa-edit"></i></button>
        <button id="download-note-btn" title="Download"><i class="fas fa-download"></i></button>
        <button id="delete-note-btn" class="delete-btn" title="Delete"><i class="fas fa-trash"></i></button>
        <button id="close-view-btn" title="Close"><i class="fas fa-times"></i></button>
      </div>
    </div>
  </div>

  <footer>
    <small>
      Kept™ • <a href="https://github.com/khuahn/" target="_blank">匠Jac</a> — All Rights Reserved ©2025<br/>
      <span>
        Powered by
        <a href="https://github.com/" target="_blank">GitHub</a> | <a href="https://www.cloudflare.com/" target="_blank">Cloudflare</a> | <a href="https://firebase.google.com/" target="_blank">Firebase</a>
      </span>
    </small>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const notesGrid = document.getElementById("notes-grid");
      const createNoteBtn = document.getElementById("create-note-btn");
      const noteModal = document.getElementById("note-modal");
      const saveNoteBtn = document.getElementById("save-note-btn");
      const cancelNoteBtn = document.getElementById("cancel-note-btn");
      const viewNoteModal = document.getElementById("view-note-modal");
      const themeToggle = document.getElementById("theme-toggle");
      const downloadAllBtn = document.getElementById("download-all-btn");
      const uploadBtn = document.getElementById("upload-btn");
      const uploadInput = document.getElementById("upload-input");
      let editIndex = null;

      const getNotes = () => JSON.parse(localStorage.getItem("kept-notes") || "[]");
      const saveNotes = (notes) => localStorage.setItem("kept-notes", JSON.stringify(notes));

      const addDefaultNote = () => {
        const notes = getNotes();
        if (notes.length === 0) {
          const timestamp = new Date().toISOString();
          const defaultNote = {
            title: "Welcome to Kept!",
            content: "Kept is your secure and simple note-taking app. Your notes are stored locally in your browser, so your data is always private.\\n\\nHere are some tips to get you started:\\n\\n- **Create a new note:** Click the '+' button to start a new note.\\n- **Upload notes:** Click the upload button to import your notes from a .txt file.\\n- **Download all notes:** Click the archive button to download all your notes as a .zip file.\\n- **Toggle theme:** Switch between light and dark mode with the theme toggle button.\\n\\nEnjoy using Kept!",
            createdAt: timestamp,
            updatedAt: timestamp,
          };
          notes.push(defaultNote);
          saveNotes(notes);
        }
      };

      const displayNotes = () => {
        const notes = getNotes().sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
        notesGrid.innerHTML = "";
        notes.forEach((note, index) => {
          const noteCard = document.createElement("div");
          noteCard.className = "note-card";
          noteCard.innerHTML = `<h3>${note.title}</h3>`;
          noteCard.addEventListener("click", () => openViewModal(index));
          notesGrid.appendChild(noteCard);
        });
      };

      const openNoteModal = (index = null) => {
        editIndex = index;
        if (index !== null) {
          const notes = getNotes().sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
          const note = notes[index];
          document.getElementById("note-title-input").value = note.title;
          document.getElementById("note-content-input").value = note.content;
        } else {
          document.getElementById("note-title-input").value = "";
          document.getElementById("note-content-input").value = "";
        }
        noteModal.style.display = "block";
      };

      const closeNoteModal = () => {
        noteModal.style.display = "none";
      };

      const openViewModal = (index) => {
        const notes = getNotes().sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
        const note = notes[index];
        document.getElementById("view-note-title").innerText = note.title;
        document.getElementById("view-note-content").innerText = note.content;
        
        const timestampEl = document.getElementById("view-note-timestamp");
        if (note.updatedAt) {
          const date = new Date(note.updatedAt);
          const formattedDate = date.toLocaleString('en-US', {
              year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit'
          });
          timestampEl.innerText = `Last edited: ${formattedDate}`;
        }

        viewNoteModal.style.display = "block";

        document.getElementById("edit-note-btn").onclick = () => {
          closeViewModal();
          openNoteModal(index);
        };

        document.getElementById("download-note-btn").onclick = () => {
            const fileContent = `Title: ${note.title}\\n\\n${note.content}`;
            const blob = new Blob([fileContent], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${note.title}.txt`;
            a.click();
            URL.revokeObjectURL(a.href);
        };

        document.getElementById("delete-note-btn").onclick = () => {
          if (confirm("Are you sure you want to delete this note?")) {
            let notes = getNotes().sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            notes.splice(index, 1);
            saveNotes(notes);
            displayNotes();
            closeViewModal();
          }
        };
      };

      const closeViewModal = () => {
        viewNoteModal.style.display = "none";
      };

      const setTheme = (theme) => {
        document.body.classList.toggle('light-mode', theme === 'light');
        themeToggle.innerHTML = theme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', theme);
      };

      downloadAllBtn.addEventListener("click", () => {
        const notes = getNotes();
        if (notes.length === 0) {
          alert("You don't have any notes to download.");
          return;
        }

        const zip = new JSZip();
        notes.forEach(note => {
          const fileContent = `Title: ${note.title}\\n\\n${note.content}`;
          zip.file(`${note.title}.txt`, fileContent);
        });

        zip.generateAsync({ type: "blob" }).then(content => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(content);
          a.download = 'kept-notes.zip';
          a.click();
          URL.revokeObjectURL(a.href);
        });
      });

      uploadBtn.addEventListener("click", () => {
        uploadInput.click();
      });

      uploadInput.addEventListener("change", (event) => {
        const files = event.target.files;
        if (!files.length) {
          return;
        }

        Array.from(files).forEach(file => {
          const title = file.name.replace(/\\.txt$/, '') || 'Untitled';
          const reader = new FileReader();
          reader.onload = (e) => {
            const noteContent = e.target.result.trim();
            const notes = getNotes();
            const timestamp = new Date().toISOString();
            notes.push({ title, content: noteContent, createdAt: timestamp, updatedAt: timestamp });
            saveNotes(notes);
            displayNotes();
          };
          reader.readAsText(file);
        });

        uploadInput.value = '';
      });

      themeToggle.addEventListener("click", () => {
        const currentTheme = localStorage.getItem('theme') || 'light';
        setTheme(currentTheme === 'dark' ? 'light' : 'dark');
      });
      
      createNoteBtn.addEventListener("click", () => openNoteModal());
      cancelNoteBtn.addEventListener("click", closeNoteModal);
      document.getElementById("close-view-btn").addEventListener("click", closeViewModal);

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeNoteModal();
          closeViewModal();
        }
      });

      saveNoteBtn.addEventListener("click", () => {
        const title = document.getElementById("note-title-input").value.trim();
        const content = document.getElementById("note-content-input").value.trim();
        if (title) {
          let notes = getNotes();
          const timestamp = new Date().toISOString();
          if (editIndex === null) {
            notes.push({ title, content, createdAt: timestamp, updatedAt: timestamp });
          } else {
            const originalNote = notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))[editIndex];
            const noteIndex = notes.findIndex(n => n.createdAt === original.createdAt);
            notes[noteIndex] = { ...notes[noteIndex], title, content, updatedAt: timestamp };
          }
          saveNotes(notes);
          displayNotes();
          closeNoteModal();
        } else {
          alert("Title cannot be empty.");
        }
      });

      addDefaultNote();
      const savedTheme = localStorage.getItem('theme') || 'light';
      setTheme(savedTheme);
      displayNotes();
    });
  </script>

</body>
</html>
